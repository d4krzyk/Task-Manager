# Task Manager

Task Manager is a backend application written in Python using Django, Django REST Framework, and PostgreSQL. It is designed for task management.

## Table of Contents
- [Features](#features)
- [Requirements](#requirements)
- [Installation](#installation)
- [Environment Configuration and SECRET_KEY](#environment-configuration-and-secret_key)
- [PostgreSQL Database Setup](#postgresql-database-setup)
- [Running Tests](#running-tests)
- [Project Structure](#project-structure)
- [Accessing the API and Admin Panel](#accessing-the-api-and-admin-panel)
- [API Documentation (Swagger)](#api-documentation-swagger)
- [Available API Endpoints](#available-api-endpoints)
- [Example curl Requests](#example-curl-requests)
- [Using API in Browser without Swagger](#using-api-in-browser-without-swagger)
- [Author](#author)

### Task Model
- `id` – automatically assigned number (integer, auto-increment)
- `name` – task name (required, short text)
- `description` – task description (optional, longer text)
- `status` – task status (required, default "New", possible values: "New", "In Progress", "Resolved")
- `assigned_to` – assigned user (optional, selected from available users)

## Requirements
- Python 3.11+
- PostgreSQL 14+
- Docker Desktop
- Django, Django REST Framework
- pip and virtualenv for local installation
- Other dependencies in `requirements.txt`

## Installation

### Local Installation (without Docker)
1. Clone the repository:
   ```bash
   git clone https://github.com/d4krzyk/Task-Manager
   cd Task-Manager
   ```
2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```
3. Create a `.env` file based on the example and generate your own SECRET_KEY (see below).
4. Run migrations:
   ```bash
   python manage.py migrate
   ```
5. Start the development server:
   ```bash
   python manage.py runserver
   ```
   Or for production with gunicorn (if installed):
   ```bash
   gunicorn config.wsgi:application
   ```

### Installation with Docker
1. Make sure you have Docker and Docker Compose installed.
2. Prepare the `.env` file (copy `.env.example` or create your own).
3. Start the application:
   ```bash
   docker-compose up --build
   ```

## Environment Configuration and SECRET_KEY

To run the project, you need a `.env` file with the appropriate variables, including SECRET_KEY. You can do this in two ways:

### 1. Automatically with Docker
If you use Docker, run:
```bash
  docker-compose up --build
```
Docker will use environment variables from `.env` (if present) or you can copy `.env.example` to `.env` before starting. If you don't have a `.env` file, create one as shown below.

### 2. Manually (locally)
If you run the project locally without Docker:
1. Create a `.env` file in the main project directory based on the example below:
   ```
   DB_NAME=task_manager_base
   DB_USER=user123
   DB_PASSWORD=yourpassword
   DB_HOST=db
   DB_PORT=5432
   SECRET_KEY=your_generated_secret_key
   ```
2. Generate SECRET_KEY with:
   ```bash
   python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
   ```
   Copy the generated key and paste it into your `.env` file.

**Note:**
- The SECRET_KEY value in `.env` should be written without quotes, e.g.:
  ```
  SECRET_KEY=django-insecure-7r+vg+k_qh0x-lqw_x#s4yb*a9t3ty70uh24@jg^)84mlg7f_8
  ```
- The `.env` file is required for the project to run.

### Example `.env` file and variable descriptions

Example `.env` content:
```
DB_NAME=task_manager_base
DB_USER=user123
DB_PASSWORD=yourpassword
DB_HOST=db
DB_PORT=5432
SECRET_KEY=your_generated_secret_key
```

Variable descriptions:
- `DB_NAME` – PostgreSQL database name
- `DB_USER` – database user name
- `DB_PASSWORD` – database user password
- `DB_HOST` – database host (e.g. `db` for Docker, `localhost` locally)
- `DB_PORT` – database port (default 5432 for PostgreSQL)
- `SECRET_KEY` – Django secret key (unique, generated by you)

## PostgreSQL Database Setup

The application uses PostgreSQL by default. Before running the project, make sure the database is available and configured as follows:

### 1. Local setup (without Docker)
1. Install PostgreSQL 14+ on your machine.
2. Create a new database and user, e.g.:
   ```bash
   psql -U postgres
   CREATE DATABASE task_manager_base;
   CREATE USER user123 WITH PASSWORD 'yourpassword';
   GRANT ALL PRIVILEGES ON DATABASE task_manager_base TO user123;
   ```
3. Set the correct credentials in your `.env` file:
   ```
   DB_NAME=task_manager_base
   DB_USER=user123
   DB_PASSWORD=yourpassword
   DB_HOST=localhost
   DB_PORT=5432
   SECRET_KEY=your_generated_secret_key
   ```

## Running Tests

Unit tests are written using pytest. You can run them in two ways:

### 1. In Docker
Enter the container:
```bash
docker-compose exec web sh
```
Then run the tests:
```bash
pytest
```

### 2. Locally
If you run the project locally (without Docker), use the command in your activated Python virtualenv:
```bash
pytest
```

## Project Structure
- `tasks/` — task management app
- `config/` — project configuration files
- `staticfiles/` — static files

## Accessing the API and Admin Panel
To use the API and Django admin panel:
1. Create a superuser in the database:
   ```bash
   python manage.py createsuperuser
   ```
   Follow the prompts and provide the required data.
2. Log in to the admin panel at `http://localhost:8000/admin/` using your credentials.
3. In the admin panel, you can add more users and manage permissions.

## API Documentation (Swagger)

You can access and test the API endpoints via the Swagger interface. After starting the application, open in your browser:

```
http://localhost:8000/docs/
```

Swagger allows interactive testing of all available API endpoints, including registration, login, task operations, and history.

## Available API Endpoints

Below is a list of main endpoints available in the application with required parameters. All task operations require JWT authentication.

- `POST   /register/` — register a new user
  - Parameters (JSON):
    - `username` (str, required)
    - `password` (str, required)
    - `password2` (str, required — password confirmation)

- `POST   /login/` — user login
  - Parameters (JSON):
    - `username` (str, required)
    - `password` (str, required)
  - Response (JSON):
    - JWT access token (e.g. `access` or `refresh`)

- `POST   /token/refresh/` — refresh JWT token
  - Parameters (JSON):
    - `refresh` (str, required — refresh token)
  - Response (JSON):
    - `access` (str) — new access token

- `GET    /tasks/` — get list of tasks (requires authentication)
  - Query parameters (optional):
    - `search` (str) — text search (case-insensitive, in name and description)
    - `id` (int) — task ID
    - `name` (str) — task name (fragment, case-insensitive)
    - `description` (str) — task description (fragment, case-insensitive)
    - `status` (str) — task status (New, In Progress, Resolved)
    - `assigned_to` (int) — assigned user ID

- `POST   /tasks/` — create a new task (requires authentication)
  - Parameters (JSON):
    - `name` (str, required)
    - `description` (str, optional)
    - `status` (str, optional — default "New")
    - `assigned_to` (int, optional — user ID)

- `GET    /tasks/{id}/` — get task details (requires authentication)
  - Parameters:
    - `id` (int, task ID — required)

- `PUT    /tasks/{id}/` — edit a task (requires authentication)
  - Parameters:
    - `id` (int, task ID — required)
    - Parameters (JSON):
      - `name` (str, required)
      - `description` (str, optional)
      - `status` (str, required)
      - `assigned_to` (int, optional)

- `PATCH  /tasks/{id}/` — partial edit of a task (requires authentication)
  - Parameters:
    - `id` (int, task ID — required)
    - Parameters (JSON):
      - any task field to change (except id)

- `DELETE /tasks/{id}/` — delete a task (requires authentication)
  - Parameters:
    - `id` (int, task ID — required)

### Task History
- `GET    /task-history/` — get history of all task changes (requires authentication)
  - Query parameters (optional):
    - `task` (int) — task ID
    - `task_id_snapshot` (int) — task ID (backup snapshot)
    - `changed_by` (int) — user ID
    - `changed_by_username` (str) — username
    - `timestamp_from` (str, $date-time) — from date (ISO 8601)
    - `timestamp_to` (str, $date-time) — to date (ISO 8601)

  Allows you to see how a task looked at any point in the past (e.g. status, assigned user).

## Example curl Requests

**Register a user:**
```bash
curl -X POST http://localhost:8000/register/ \
  -H "Content-Type: application/json" \
  -d '{"username": "user1", "password": "password123", "password2": "password123"}'
```

**Login and get JWT token:**
```bash
curl -X POST http://localhost:8000/login/ \
  -H "Content-Type: application/json" \
  -d '{"username": "user1", "password": "password123"}'
```

**Add a task:**
```bash
curl -X POST http://localhost:8000/tasks/ \
  -H "Authorization: Bearer <ACCESS_TOKEN>" \
  -H "Content-Type: application/json" \
  -d '{"name": "New task", "description": "Description", "status": "New", "assigned_to": null}'
```

**Get tasks assigned to user with id=2:**
```bash
curl -X GET "http://localhost:8000/tasks/?assigned_to=2" \
  -H "Authorization: Bearer <ACCESS_TOKEN>"
```

**Filter tasks by status:**
```bash
curl -X GET "http://localhost:8000/tasks/?status=New" \
  -H "Authorization: Bearer <ACCESS_TOKEN>"
```

**Search tasks containing the word 'cooking' in name or description:**
```bash
curl -X GET "http://localhost:8000/tasks/?search=cooking" \
  -H "Authorization: Bearer <ACCESS_TOKEN>"
```

**Get history for task with id=1:**
```bash
curl -X GET "http://localhost:8000/task-history/?task=1" \
  -H "Authorization: Bearer <ACCESS_TOKEN>"
```

## Using API in Browser without Swagger

If you want to use the API in your browser (e.g. at /api/tasks/) without Swagger (/docs/), and your endpoints require JWT authentication, you can use the ModHeader browser extension (Chrome/Firefox).

**Instructions:**
1. Install the ModHeader extension in your browser.
2. Open ModHeader and add a new header:
   - Name: `Authorization`
   - Value: `Bearer <your_access_token>`
     (e.g. Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...)
3. Make sure ModHeader is active on your API page (e.g. http://localhost:8000/api/tasks/).
4. Refresh the DRF panel page – you will have access to protected resources as an authenticated user.

This way you can test and use the API without Swagger or Postman, directly in your browser.

## Author
- d4krzyk - [GitHub](dhttps://github.com/d4krzyk) | [LinkedIn](https://www.linkedin.com/in/d4krzyk/)
